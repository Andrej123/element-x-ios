<html>
  <head>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@^3"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@^2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@^1"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.7.0/d3.min.js"></script>
  </head>
  <body>
    <h2>Launch time performance</h2>
    <div style="width: 800px"><canvas id="launchPerformance"/></div>
    <h2>Login performance</h2>
    <div style="width: 800px"><canvas id="loginPerformance"/></div>
  <script>
  d3.csv('./perf-data.csv').then(makeCharts);
  
  function floatify(perfdata) {
    return perfdata.map(
      function(d) {
        d.Data1 = parseFloat(d.Data1);
        d.Data2 = parseFloat(d.Data2);
        d.Data3 = parseFloat(d.Data3);
        d.Data4 = parseFloat(d.Data4);
        d.Data5 = parseFloat(d.Data5);
        return d
      }
    );
  }
    
  function makeCharts(stringdata) { 
    var perfdata = floatify(stringdata);
    var launchPerformance = perfdata.filter(function (d) { return d.Test == "launchPerformance"  });
    makeChart(launchPerformance,"launchPerformance")
    var loginPerformance = perfdata.filter(function (d) { return d.Test == "loginPerformance"  });
    makeChart(loginPerformance,"loginPerformance")
  }
    
  function makeChart(perfdata, canvas_id) {
    console.log(perfdata);
    var maxData = perfdata.map(
      function(d) { return { x: d.Date, y: Math.max(d.Data1, d.Data2, d.Data3, d.Data4, d.Data5) } });
    var minData = perfdata.map(
      function(d) { return { x: d.Date, y: Math.min(d.Data1, d.Data2, d.Data3, d.Data4, d.Data5) } });

    var avgData = perfdata.map(
      function(d) {
        return {
          x: d.Date,
          y: (d.Data1 + d.Data2 + d.Data3 + d.Data4 + d.Data5)/5
        }
      }
    );
    console.log(minData);
    console.log(avgData);
    console.log(maxData);
    var chart = new Chart(canvas_id, {
      type: 'line',
      data: {
        datasets: [
          {
            label: "min",
            data: minData,
            fill: "+1",
            borderColor: "#CCFFCC"
          },
          {
            label: "avg",
            data: avgData,
            borderColor: "#CCCCFF"
          },
          {
            label: "max",
            data: maxData,
            fill: "-1",
            borderColor: "#FFCCCC"
          }
        ]
      },
      options: {
        interaction: {
          intersect: false,
          mode: 'index', 
        },
        scales: {
          x: {
            type: 'time',
            label: "Test run date",
            display: "true",
            time: {
            }
          },
          y: {
            display: "true",
            label: "Duration" 
          }
        }
      }
    });
  }
  </script>
  </body>

</html>
  
    
